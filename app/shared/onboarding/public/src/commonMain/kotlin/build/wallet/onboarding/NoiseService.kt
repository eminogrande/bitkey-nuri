package build.wallet.onboarding

import build.wallet.crypto.NoiseInitiator
import build.wallet.crypto.NoiseSessionState
import build.wallet.f8e.F8eEnvironment
import com.github.michaelbull.result.Result

/**
 * Establishes a Noise secure channel with WSM. The session ID is generated by WSM and is
 * returned to the mobile app, which persists it.
 *
 * The session ID is used in conjunction AWS Application Load Balancer (ALB) sticky sessions to
 * ensure that the same WSM instance is used for all requests in a session.
 */
interface NoiseService {
  suspend fun establishNoiseSecureChannel(
    f8eEnvironment: F8eEnvironment,
  ): Result<NoiseSessionState, Throwable>

  // TODO Refactor this and inline NoiseInitiatorImpl into this interface.
  fun getNoiseInitiator(): NoiseInitiator
}
